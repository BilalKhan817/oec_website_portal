<h2 mat-dialog-title>{{ isEditMode ? 'Edit' : 'Add' }} Menu Item</h2>

<mat-dialog-content>
  <form [formGroup]="menuForm" class="menu-form">
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Title</mat-label>
        <input matInput formControlName="title" placeholder="Home" required>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Icon (FontAwesome class)</mat-label>
        <input matInput formControlName="icon" placeholder="fas fa-home" required>
        <mat-hint>Example: fas fa-home, fas fa-info-circle</mat-hint>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-checkbox formControlName="has_dropdown">
        Has Dropdown Menu
      </mat-checkbox>
    </div>

    <div class="form-row" *ngIf="!menuForm.get('has_dropdown')?.value">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Link</mat-label>
        <input matInput formControlName="link" placeholder="/home">
        <mat-hint>Router path or external URL</mat-hint>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Link Type</mat-label>
        <mat-select formControlName="link_type">
          <mat-option *ngFor="let type of linkTypes" [value]="type.value">
            {{ type.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="dropdown-config" *ngIf="menuForm.get('has_dropdown')?.value">
      <h3>Dropdown Configuration</h3>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Dropdown Type</mat-label>
          <mat-select formControlName="dropdown_type">
            <mat-option *ngFor="let type of dropdownTypes" [value]="type.value">
              {{ type.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Dropdown Width</mat-label>
          <input matInput formControlName="dropdown_width" placeholder="400px">
        </mat-form-field>
      </div>

      <div class="json-editor-section">
        <button mat-stroked-button type="button" (click)="toggleJsonEditor()">
          <mat-icon>{{ showJsonEditor ? 'visibility_off' : 'code' }}</mat-icon>
          {{ showJsonEditor ? 'Hide' : 'Show' }} JSON Editor (Tabs & Items)
        </button>

        <div *ngIf="showJsonEditor" class="json-editor">
          <p class="hint">Edit the tabs and items structure in JSON format:</p>
          <textarea
            [(ngModel)]="jsonContent"
            [ngModelOptions]="{standalone: true}"
            rows="15"
            class="json-textarea"></textarea>
          <mat-hint>Format: {{"{"}} "tabs": [...], "items": [...] {{"}"}}</mat-hint>
        </div>
      </div>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="half-width">
        <mat-label>Order</mat-label>
        <input matInput type="number" formControlName="order" placeholder="0">
        <mat-hint>Lower numbers appear first</mat-hint>
      </mat-form-field>

      <div class="half-width">
        <mat-checkbox formControlName="is_active">
          Active
        </mat-checkbox>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()" [disabled]="loading">Cancel</button>
  <button mat-raised-button color="primary" (click)="save()" [disabled]="loading">
    <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
    <span *ngIf="!loading">{{ isEditMode ? 'Update' : 'Create' }}</span>
  </button>
</mat-dialog-actions>
