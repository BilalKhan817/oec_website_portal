<div class="page-container">
  <div class="page-header">
    <h2>Navbar Menu Management</h2>
    <p class="subtitle">Manage navigation menus and submenu items with descriptions for the public website</p>
  </div>

  <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>

  <!-- Menu Form Modal -->
  <mat-card *ngIf="showMenuForm" class="form-card elevated">
    <mat-card-header>
      <mat-card-title>{{ isEditingMenu ? 'Edit' : 'Create' }} Menu</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="menuForm" (ngSubmit)="onSubmitMenu()">
        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Menu Title</mat-label>
            <input matInput formControlName="title" required placeholder="e.g., About Us">
            <mat-error>Title is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Slug</mat-label>
            <input matInput formControlName="slug" required placeholder="e.g., about-us">
            <mat-hint>Used in URL (lowercase, no spaces)</mat-hint>
            <mat-error>Slug is required</mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>URL</mat-label>
            <input matInput formControlName="url" placeholder="/about-us">
          </mat-form-field>

          <mat-form-field appearance="outline" class="quarter-width">
            <mat-label>Order</mat-label>
            <input matInput type="number" formControlName="order" required>
          </mat-form-field>

          <mat-form-field appearance="outline" class="quarter-width">
            <mat-label>Icon</mat-label>
            <input matInput formControlName="icon" placeholder="material-icon-name">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-slide-toggle formControlName="isActive" class="toggle-field">
            Active
          </mat-slide-toggle>

          <mat-slide-toggle formControlName="openInNewTab" class="toggle-field">
            Open in New Tab
          </mat-slide-toggle>

          <mat-slide-toggle formControlName="hasSubmenu" class="toggle-field">
            Has Submenu
          </mat-slide-toggle>
        </div>

        <div class="form-actions">
          <button mat-button type="button" (click)="cancelMenuForm()" [disabled]="isLoading">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="isLoading || menuForm.invalid">
            <mat-icon>save</mat-icon> {{ isEditingMenu ? 'Update' : 'Create' }} Menu
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Submenu Form Modal -->
  <mat-card *ngIf="showSubmenuForm" class="form-card elevated">
    <mat-card-header>
      <mat-card-title>{{ isEditingSubmenu ? 'Edit' : 'Create' }} Submenu Item</mat-card-title>
      <mat-card-subtitle>Add navigation items with descriptions that appear on hover</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="submenuForm" (ngSubmit)="onSubmitSubmenu()">
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width" *ngIf="!selectedMenuForSubmenu">
            <mat-label>Parent Menu</mat-label>
            <mat-select formControlName="menuId" required>
              <mat-option *ngFor="let menu of menus" [value]="menu._id">
                {{ menu.title }}
              </mat-option>
            </mat-select>
            <mat-error>Parent menu is required</mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Submenu Title</mat-label>
            <input matInput formControlName="title" required placeholder="e.g., About OEC">
            <mat-error>Title is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Slug</mat-label>
            <input matInput formControlName="slug" required placeholder="e.g., about-oec">
            <mat-hint>Used in URL (lowercase, no spaces)</mat-hint>
            <mat-error>Slug is required</mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description" rows="2"
                      placeholder="e.g., Leading organization for overseas employment."></textarea>
            <mat-hint>This description appears below the menu item on the website</mat-hint>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>URL</mat-label>
            <input matInput formControlName="url" placeholder="/about-us/about-oec">
          </mat-form-field>

          <mat-form-field appearance="outline" class="quarter-width">
            <mat-label>Order</mat-label>
            <input matInput type="number" formControlName="order" required>
          </mat-form-field>

          <mat-form-field appearance="outline" class="quarter-width">
            <mat-label>Icon</mat-label>
            <input matInput formControlName="icon" placeholder="material-icon-name">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-slide-toggle formControlName="isActive" class="toggle-field">
            Active
          </mat-slide-toggle>

          <mat-slide-toggle formControlName="openInNewTab" class="toggle-field">
            Open in New Tab
          </mat-slide-toggle>
        </div>

        <div class="form-actions">
          <button mat-button type="button" (click)="cancelSubmenuForm()" [disabled]="isLoading">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="isLoading || submenuForm.invalid">
            <mat-icon>save</mat-icon> {{ isEditingSubmenu ? 'Update' : 'Create' }} Submenu
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Menus List -->
  <div *ngIf="!showMenuForm && !showSubmenuForm">
    <div class="actions-bar">
      <button mat-raised-button color="primary" (click)="showCreateMenuForm()">
        <mat-icon>add</mat-icon> Add New Menu
      </button>
    </div>

    <div class="menus-container">
      <mat-accordion>
        <mat-expansion-panel *ngFor="let menu of menus" class="menu-panel">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-icon class="menu-icon">{{ menu.icon || 'menu' }}</mat-icon>
              <span class="menu-title">{{ menu.title }}</span>
              <mat-chip class="status-chip" [class.active]="menu.isActive" [class.inactive]="!menu.isActive">
                {{ menu.isActive ? 'Active' : 'Inactive' }}
              </mat-chip>
            </mat-panel-title>
            <mat-panel-description>
              <span class="order-badge">Order: {{ menu.order }}</span>
              <span class="submenu-badge" *ngIf="menu.hasSubmenu">
                <mat-icon>arrow_drop_down</mat-icon> Has Submenus
              </span>
            </mat-panel-description>
          </mat-expansion-panel-header>

          <div class="menu-details">
            <div class="menu-info">
              <p><strong>Slug:</strong> {{ menu.slug }}</p>
              <p *ngIf="menu.url"><strong>URL:</strong> {{ menu.url }}</p>
            </div>

            <div class="menu-actions">
              <button mat-button color="primary" (click)="showEditMenuForm(menu)">
                <mat-icon>edit</mat-icon> Edit Menu
              </button>
              <button mat-button color="accent" (click)="showCreateSubmenuForm(menu._id)">
                <mat-icon>add</mat-icon> Add Submenu
              </button>
              <button mat-button color="warn" (click)="deleteMenu(menu._id)">
                <mat-icon>delete</mat-icon> Delete
              </button>
            </div>

            <!-- Submenus List -->
            <div class="submenus-section" *ngIf="getSubmenusByMenuId(menu._id).length > 0">
              <h3>Submenu Items</h3>
              <div class="submenus-grid">
                <mat-card *ngFor="let submenu of getSubmenusByMenuId(menu._id)" class="submenu-card">
                  <mat-card-content>
                    <div class="submenu-header">
                      <h4>{{ submenu.title }}</h4>
                      <mat-chip class="status-chip-small" [class.active]="submenu.isActive" [class.inactive]="!submenu.isActive">
                        {{ submenu.isActive ? 'Active' : 'Inactive' }}
                      </mat-chip>
                    </div>

                    <p class="submenu-description" *ngIf="submenu.description">
                      <mat-icon class="desc-icon">description</mat-icon>
                      {{ submenu.description }}
                    </p>

                    <div class="submenu-meta">
                      <span class="meta-item"><strong>Slug:</strong> {{ submenu.slug }}</span>
                      <span class="meta-item"><strong>Order:</strong> {{ submenu.order }}</span>
                    </div>

                    <div class="submenu-actions">
                      <button mat-icon-button color="primary" (click)="showEditSubmenuForm(submenu)" matTooltip="Edit">
                        <mat-icon>edit</mat-icon>
                      </button>
                      <button mat-icon-button color="warn" (click)="deleteSubmenu(submenu._id)" matTooltip="Delete">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </div>

            <div *ngIf="getSubmenusByMenuId(menu._id).length === 0" class="no-submenus">
              <p>No submenu items yet.</p>
              <button mat-stroked-button color="primary" (click)="showCreateSubmenuForm(menu._id)">
                <mat-icon>add</mat-icon> Add First Submenu
              </button>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>

      <div *ngIf="menus.length === 0 && !isLoading" class="empty-state">
        <mat-icon>menu_open</mat-icon>
        <h3>No Navigation Menus Found</h3>
        <p>Create your first navigation menu to get started.</p>
        <button mat-raised-button color="primary" (click)="showCreateMenuForm()">
          <mat-icon>add</mat-icon> Create First Menu
        </button>
      </div>
    </div>
  </div>
</div>
